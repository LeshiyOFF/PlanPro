# ProjectLibre Core - Тестовая инфраструктура

## Обзор

Этот модуль содержит **изолированные unit-тесты** для критической бизнес-логики ProjectLibre Core.
Тесты разработаны для безопасного рефакторинга legacy кода без риска регрессий.

## Статус тестов

| Категория | Тестов | Статус |
|-----------|--------|--------|
| AssignmentCostTest | 15 | ✅ Все проходят |
| ResourceAvailabilityTest | 17 | ✅ Все проходят |
| CriticalPathTest | 18 | ✅ Все проходят |
| ProjectIdTest | 7 | ✅ Все проходят |
| JsonSerializationTest | 5 | ✅ Все проходят |
| **ИТОГО** | **62** | ✅ **100% проходят** |

## Архитектура тестов

### Принцип изоляции

Тесты разработаны как **полностью изолированные unit-тесты**, которые:
- НЕ требуют инициализации ProjectLibre Core
- НЕ зависят от SessionFactory, CalendarService, или других legacy сервисов
- Тестируют алгоритмы и логику напрямую
- Могут запускаться независимо от основной кодовой базы

### Структура тестов

```
src/test/java/com/projectlibre1/
├── pm/
│   ├── TestUtils.java              # Общие утилиты и константы
│   ├── TestEnvironmentInitializer.java  # Для будущих интеграционных тестов
│   ├── assignment/
│   │   ├── AssignmentCostTest.java      # Расчёт стоимости назначений
│   │   └── ResourceAvailabilityTest.java # Доступность ресурсов
│   └── task/
│       ├── ProjectIdTest.java           # Генерация ID (UUID)
│       └── CriticalPathTest.java        # Критический путь
└── serialization/
    └── JsonSerializationTest.java       # JSON сериализация
```

## Запуск тестов

### Maven (рекомендуется)

```bash
cd projectlibre_core

# Запустить все тесты
java -Dmaven.multiModuleProjectDirectory=. -cp ".mvn\wrapper\maven-wrapper.jar" org.apache.maven.wrapper.MavenWrapperMain test

# Запустить конкретный тест
java -Dmaven.multiModuleProjectDirectory=. -cp ".mvn\wrapper\maven-wrapper.jar" org.apache.maven.wrapper.MavenWrapperMain test -Dtest=ProjectIdTest
```

### Если установлен Maven глобально

```bash
cd projectlibre_core
mvn test
```

## Покрытие бизнес-логики

### 1. AssignmentCostTest (15 тестов)

Тестирует логику расчёта стоимости назначений:
- ✅ Стандартная стоимость работы
- ✅ Стоимость сверхурочной работы
- ✅ Частичная занятость (50% units)
- ✅ Множественное распределение (200% units)
- ✅ Линейное масштабирование стоимости
- ✅ Нулевые значения (работа, ставка, units)

### 2. ResourceAvailabilityTest (17 тестов)

Тестирует логику доступности ресурсов:
- ✅ Начальная доступность ресурса
- ✅ Уменьшение доступности при назначении
- ✅ Накопление множественных назначений
- ✅ Защита от перераспределения
- ✅ Освобождение ресурсов
- ✅ Пул ресурсов

### 3. CriticalPathTest (18 тестов)

Тестирует логику критического пути:
- ✅ Нулевой резерв = критическая задача
- ✅ Малый резерв = критическая задача
- ✅ Большой резерв = некритическая задача
- ✅ Конфигурируемый порог
- ✅ Параметризованные тесты с различными значениями
- ✅ Граничные случаи (отрицательные значения, нули)

### 4. ProjectIdTest (7 тестов)

Тестирует генерацию идентификаторов:
- ✅ Уникальность последовательных ID
- ✅ Уникальность UUID-based ID
- ✅ Положительность UUID ID
- ✅ Thread-safety при генерации
- ✅ Производительность генерации UUID

### 5. JsonSerializationTest (5 тестов)

Тестирует базовую JSON сериализацию:
- ✅ Сериализация проекта
- ✅ Сериализация задачи
- ✅ Сериализация ресурса
- ✅ Обработка null
- ✅ Проект с задачами

## Использование для рефакторинга

### Безопасный рефакторинг TODO

1. **Перед изменением**: Запустите тесты и убедитесь, что все проходят
2. **После изменения**: Запустите тесты снова
3. **Если тесты падают**: Изменение нарушило существующую логику

### Пример рабочего процесса

```bash
# 1. Проверяем, что всё работает до изменений
mvn test
# Tests run: 62, Failures: 0

# 2. Вносим изменения в код
# ... редактирование NormalTask.java ...

# 3. Проверяем, что ничего не сломали
mvn test
# Tests run: 62, Failures: 0

# 4. Изменения безопасны!
```

## Расширение тестов

При добавлении новых тестов следуйте принципам:

1. **Изоляция**: Тест не должен зависеть от инициализации ProjectLibre
2. **Простота**: Тестируйте один аспект логики за раз
3. **Воспроизводимость**: Тест должен давать одинаковый результат при каждом запуске
4. **Скорость**: Тест должен выполняться быстро (< 1 секунды)

### Шаблон теста

```java
@Test
@DisplayName("Описание что тестируем")
void testMethodName() {
    // Arrange - подготовка данных
    long input = 1000L;
    
    // Act - выполнение
    long result = calculateSomething(input);
    
    // Assert - проверка
    Assertions.assertEquals(expected, result, "Сообщение об ошибке");
}
```

## Зависимости

- **JUnit 5.10.2** - фреймворк тестирования
- **Java 17+** - требуемая версия Java

## История изменений

| Версия | Дата | Изменения |
|--------|------|-----------|
| 2.0.0 | 2026-01-31 | Полная переработка на изолированные тесты |
| 1.0.0 | 2026-01-30 | Первая версия (требовала инициализации) |
